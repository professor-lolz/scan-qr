<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Сканер NFC</title>
<style>
  body { font-family: system-ui,Segoe UI,Roboto,Helvetica,Arial; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f0f2f5; }
  .card { padding:20px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.08); text-align:center; width:min(480px,90%); background:#fff; }
  button { padding:10px 14px; border-radius:8px; border:0; font-size:16px; cursor:pointer; background:#007aff; color:white; }
  button:hover { opacity:0.9; }
  pre { word-break: break-all; background:#f6f6f6; padding:10px; border-radius:8px; }
</style>
</head>
<body>
<div class="card">
  <h2>Сканирование NFC</h2>
  <p id="status">Нажмите кнопку для сканирования</p>
  <button id="scanBtn">Сканировать метку</button>
  <pre id="result">—</pre>
</div>
<script>
const BOT_USERNAME = 'inventar_polik_bot'; // ваш бот

async function scanNfc(){
  const statusEl = document.getElementById('status');
  const resultEl = document.getElementById('result');
  statusEl.textContent = 'Запрашиваю доступ к NFC...';

  if (!('NDEFReader' in window)){
    statusEl.textContent = 'Web NFC не поддерживается. Используйте Android Chrome';
    return;
  }

  try{
    const reader = new NDEFReader();
    await reader.scan();
    statusEl.textContent = 'Ожидание метки';

    reader.onreading = event => {
      const serial = event.serialNumber || 'UNKNOWN_SERIAL';
      statusEl.textContent = 'Метка считана';
      resultEl.textContent = serial;

      // Редирект в Telegram бота с start параметром
      const deepLink = `https://t.me/${BOT_USERNAME}?start=${serial}`;
      window.location.href = deepLink;
    };

    reader.onreadingerror = () => statusEl.textContent = 'Ошибка чтения метки';
  } catch(err){
    statusEl.textContent = 'Отмена или ошибка: ' + err.message;
    console.error(err);
  }
}

document.getElementById('scanBtn').addEventListener('click', scanNfc);
</script>
</body>
</html>
